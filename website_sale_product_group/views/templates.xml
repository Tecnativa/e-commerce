<?xml version="1.0" encoding="UTF-8"?>
<!-- Â© 2016 Carlos Dauden <carlos.dauden@tecnativa.com>
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl-3). -->
<openerp>
<data>

<template id="product_pack_item" name="Product pack item">
    <form id="update_cart" action="/shop/cart/update" method="post">
        <div class="row mb16">
            <h4 t-field="product_pack.block.name"/>
            <hr/>
        </div>
        <t t-foreach="product_pack.line_ids" t-as="pack_item">
            <div class="row mb8">
                <div class="row">
                    <div id="product_pack_name" class="col-md-10">
                        <input type="checkbox" id="product_check" class="chk_line js_productCheck checkbox-info"
                               t-att-data-unit="1.0"
                               t-att-data-price="pack_item.product_id.price"
                               t-att-data-lst_price="pack_item.product_id.lst_price"
                               t-att-data-product_id="pack_item.product_id.id"
                               t-att-data-pack_item_id="pack_item.id"
                               t-att-data-public_categ_id="category.id"
                               t-att-checked="'checked' if pack_item.default_checked else None"/>
                        <strong><span t-field="pack_item.product_id.name"/></strong>
                    </div>
                    <div id="product_pack_price" class="col-md-1 text-right">
                        <b>
                          <t t-if="(compute_currency(pack_item.product_id.lst_price) - pack_item.product_id.price) &gt; 0.1">
                            <del class="text-danger" style="white-space: nowrap;" t-field="pack_item.product_id.lst_price" t-field-options='{
                              "widget": "monetary",
                              "from_currency": "pack_item.product_id.company_id.currency_id",
                              "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                            }'/>&amp;nbsp;
                            <span t-esc="int(round(((pack_item.product_id.price / (compute_currency(pack_item.product_id.lst_price) or 1.00)) - 1) * 100, 0))"/>
                            <span>%</span>
                          </t>
                          <span t-field="pack_item.product_id.price" style="white-space: nowrap;"  t-field-options='{
                               "widget": "monetary",
                               "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                           }'>
                          </span>
                          <span itemprop="price" style="display:none;" t-esc="pack_item.product_id.price"/>
                          <span itemprop="priceCurrency" style="display:none;" t-esc="user_id.partner_id.property_product_pricelist.currency_id.name"/>
                        </b>
                        <input name="product_id" t-att-value="pack_item.product_id.id" type="hidden"/>
                        <input name="pack_item" t-att-value="pack_item.id" type="hidden"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-10 col-md-offset-1">
                        <span t-field="pack_item.product_id.description_sale"/>
                    </div>
                </div>
            </div>
        </t>
    </form>
</template>

<template id="total_selected_amount">
    <div class="row text-right">
        <div class="pull-right mb16">
            <h5>Total Of Your Selection: <span id="total_selected_price"/></h5>
            <h5>Total Of Your Selection: <span id="total_selected_lst_price"/></h5>
            <button id="add_to_cart"
                    class="btn btn-primary btn-md a-submit"
                    type="submit"
                    form="update_cart">Add to cart</button>
        </div>
    </div>
</template>

<template id="product_packs_view" inherit_id="website_sale.products" active="False" customize_show="True" name="Product Pack View">
  <xpath expr="//div[@id='products_grid']/*[1]" position="after">
      <div t-if="product_packs">
          <t t-call="website_sale_product_group.total_selected_amount"/>
          <t t-foreach="product_packs" t-as="product_pack">
              <div class="oe_product oe_list oe_product_cart">
                  <t t-call="website_sale_product_group.product_pack_item"/>
              </div>
          </t>
      </div>
  </xpath>
</template>

<!-- /shop/cart -->
<template id="cart" inherit_id="website_sale.cart">

    <xpath expr="//t[@t-foreach='website_sale_order.website_order_line']" position="before">
        <t t-set="init_block" t-value="False"/>
    </xpath>

    <xpath expr="//t[@t-foreach='website_sale_order.website_order_line']/tr" position="before">
        <t t-set="block" t-value="line.product_id.website_pack_ids[:1].pack_id.block"/>
        <tr t-if="init_block &lt;&gt; block">
            <td colspan="5" class="block-separator">
                <t t-if="line.product_id.website_pack_ids">
                    <h5>
                        <span t-field="line.product_id.website_pack_ids[:1].pack_id.public_categ_ids[:1].parent_id.name"/>
                        <span t-field="line.product_id.website_pack_ids[:1].pack_id.public_categ_ids[:1].name"/>
                        <span t-field="line.product_id.website_pack_ids[:1].pack_id.block"/>
                    </h5>
                </t>
                <t t-if="not line.product_id.website_pack_ids">
                    <h5>SINGLES</h5>
                </t>
            </td>
            <t t-set="init_block" t-value="block"/>
        </tr>
    </xpath>

</template>

<!-- /shop/payment -->
<template id="payment" inherit_id="website_sale.payment">

    <xpath expr="//tr[@t-foreach='website_sale_order.website_order_line']" position="before">
        <t t-set="init_block" t-value="False"/>
    </xpath>

    <xpath expr="//tr[@t-foreach='website_sale_order.website_order_line']/td" position="before">
        <t t-set="block" t-value="line.product_id.website_pack_ids[:1].pack_id.block"/>
        <t t-if="init_block &lt;&gt; block">
            <tr>
                <td colspan="5" class="block-separator">
                    <t t-if="line.product_id.website_pack_ids">
                        <h5>
                            <span t-field="line.product_id.website_pack_ids[:1].pack_id.public_categ_ids[:1].parent_id.name"/>
                            <span t-field="line.product_id.website_pack_ids[:1].pack_id.public_categ_ids[:1].name"/>
                            <span t-field="line.product_id.website_pack_ids[:1].pack_id.block"/>
                        </h5>
                    </t>
                    <t t-if="not line.product_id.website_pack_ids">
                        <h5>SINGLES</h5>
                    </t>
                </td>
                <t t-set="init_block" t-value="block"/>
            </tr>
        </t>
    </xpath>

</template>

</data>
</openerp>
